---
title: Enhancing Response Accuracy with Instructor and Pydantic
slug: why-instructor
coverImage: /images/posts/python-workspace-cartoon.JPG
date: 2024-01-16T00:00:00.000Z
excerpt: Exploring how Instructor leverages Pydantic to optimize OpenAI's function call API for more accurate and context-aware responses.
tags:
  - AI
  - Validation
  - Python
  - Machine Learning
---

<script>
  import Callout from "$lib/components/molecules/Callout.svelte";
  import CodeBlock from "$lib/components/molecules/CodeBlock.svelte";
  import Image from "$lib/components/atoms/Image.svelte";
</script>

## Introduction

`Instructor` is a powerful tool designed to enhance the accuracy of responses from OpenAI's function call API. By integrating with `Pydantic`, it simplifies the process of parsing, validating, and retrying API responses. This seamless integration allows developers to ensure more accurate and context-aware responses, making it an essential tool for anyone working with OpenAI's API.

## The Need for Dynamic Validation

In the realm of software development, validation has traditionally been static and rule-based, limiting its adaptability to new challenges. Instructor, however, introduces a dynamic, machine learning-driven approach. This post dives into how Python libraries like `Pydantic` and `Instructor` can be used to revolutionize validation in your software stack.

### The Problem with Static Validation

**Scenario: Ensuring Data Integrity in Customer Information**

In a context where a software company is dedicated to maintaining accurate and reliable customer data, the challenge is to ensure all information conforms to standardized formats and criteria.

**Approach** 

A practical method might involve establishing a list of validation rules for customer data entries. For instance, we could decide that email addresses must follow a specific format. We can adjust our validation framework in Pydantic to include these criteria.


<CodeBlock lang="python">

```python
from pydantic import BaseModel, EmailStr

class Customer(BaseModel):
    name: str
    email: EmailStr
    phone_number: str
    address: str

customer = Customer(
    name="John Doe",
    email="johndoe@notanemail",
    phone_number="1234567890",
    address="123 Main Street"
)
print(customer)
# value is not a valid email address: The part after the @-sign is not valid.
# It should have a period. 
# [type=value_error, input_value='johndoe@notanemail', input_type=str]
```

</CodeBlock>

This results in error prevention for entries that do not meet the set standards, like incorrect email formats.

**Adapting to New Challenges in Customer Information Validation**

Imagine we receive new customer data that, on the surface, seems valid but contains subtle inaccuracies or inappropriate content. For instance, a customer might enter a seemingly valid email address that actually includes objectionable language. Our basic validators for format and structure wouldn't flag this as an error, highlighting the need for more nuanced validation techniques.

## Building an LLM-Powered Validator

Moving beyond simple field validators, we now explore probabilistic validation in software 2.0, specifically through prompt engineering. We introduce an LLM-powered validator, `llm_validator`, which uses contextual understanding to assess the validity of the data.
<CodeBlock lang="python">



```python
from instructor import llm_validator
from pydantic import BaseModel, ValidationError
from typing import Annotated
from pydantic.functional_validators import AfterValidator

class CustomerData(BaseModel):
    email: Annotated[str, AfterValidator(llm_validator("ensure valid and appropriate content"))]

try:
    CustomerData(email="inappropriate@example.com")
except ValidationError as e:
    print(e)

```

</CodeBlock>

<p>
<br>
This validation process produces an error message for inappropriate or invalid content in customer data entries. For example:
<br>
<br>
</p>

<CodeBlock lang="python">


```bash
1 validation error for CustomerData
email
  Assertion failed, The email address contains inappropriate content. 
  [type=assertion_error, input_value='inappropriate@example.com', input_type=str]

```

</CodeBlock>

<p>
<br>
The error message is generated by the language model (LLM), offering a context-sensitive approach to data validation. This method is particularly useful for dynamically adapting to new types of invalid or inappropriate content.
</p>

## Advancing to Machine Learning-Driven Validation

The integration of `Instructor` with `Pydantic` allows for the utilization of machine learning models to enhance validation processes. It enables the transition from static, rule-based methods to dynamic, context-aware ones. This approach is particularly useful for adapting to new challenges in data validation.

## Conclusion

`Instructor` extends far beyond basic validation techniques, unlocking a myriad of advanced use cases in software development. It adeptly handles complex tasks such as Validating Citations From Original Text, Validating Chain of Thought, and provides robust Error Handling and Re-Asking mechanisms. These capabilities are not just incremental improvements; they represent a paradigm shift in how we approach data validation and processing.

The true power of `Instructor` is exemplified through its enhancements to the OpenAI class, primarily:

1. Response Model: By specifying a `Pydantic` model, `Instructor` streamlines data extraction, ensuring that responses are structured and precise.

2. Max Retries: Customization of retry attempts is a game-changer, offering flexibility and resilience in handling request failures.

3. Validation Context: The introduction of a context object for validators opens new doors for more nuanced and sophisticated validation strategies.

Together, `Instructor` and `Pydantic` mark a significant leap in the evolution of dynamic validation. They are not just about preventing bad data; they empower large language models to understand, interpret, and correct data in a way that was previously unimaginable. This advancement paves the way for the development of more intelligent, adaptive, and responsive software systems.

For a deeper dive into the world of advanced validation and to experience the full potential of `Instructor`, I invite you to visit the [GitHub page](https://github.com/jxnl/instructor) and explore the many ways it can enhance your projects.
